# 20. クイズプレビューページ

## 概要

クイズ作成者が公開前にクイズの外観と動作を確認するためのプレビューページ。実際の受験環境と同じレイアウトとユーザー体験を提供し、問題、回答インターフェース、フローをテストできる。管理者のみがアクセス可能。

## ページ構成

1. **プレビューモード表示**

   - 「プレビューモード」表示バー
   - 「編集に戻る」ボタン
   - 「公開設定」ボタン
   - デバイス切替ボタン（デスクトップ/タブレット/モバイル）

2. **クイズヘッダー**

   - クイズタイトル
   - 組織ロゴ（設定されている場合）
   - テーマカラー（カスタマイズされている場合）

3. **導入セクション**

   - クイズの説明文
   - 合格点の表示
   - 時間制限の表示（設定されている場合）
   - 問題数と総配点
   - 「開始」ボタン

4. **受験者情報フォーム**

   - 名前/メールアドレス入力フィールド（サンプルデータ自動入力）
   - その他必須フィールド（設定に応じて）
   - プライバシーポリシー同意チェックボックス
   - 「開始」ボタン

5. **クイズ本体**

   - 問題カウンター（例：Question 3 of 10）
   - 進捗バー
   - 残り時間表示（時間制限がある場合）
   - 問題文表示
   - メディア表示（画像/音声/動画）
   - 回答インターフェース（問題タイプに応じた表示）
   - ヒント表示（設定されている場合）

6. **問題ナビゲーション**

   - 前の問題/次の問題ボタン
   - 問題番号リスト
   - 回答済み/未回答/フラグ付き表示
   - 「すべて提出」ボタン

7. **採点結果表示**

   - スコア表示（自動採点モードの場合）
   - 正解/不正解表示
   - 解説表示（設定されている場合）
   - 各問題の復習ナビゲーション

8. **プレビュー制御パネル**

   - 「デザイン設定をテスト」トグル
   - 「採点モードをテスト」トグル
   - 「時間制限をテスト」トグル
   - 「自由記述問題の模擬採点」ボタン（手動採点モードの場合）

9. **プレビューフィードバック入力**

   - 問題点や改善点のメモ入力欄
   - 「メモを保存」ボタン

10. **デバイスシミュレーション**
    - デスクトップ/タブレット/モバイル表示の切り替え
    - 各デバイスでのレスポンシブデザインプレビュー

## 技術仕様

- **コンポーネント構成**

  - `PreviewHeader.tsx`
  - `DeviceSimulator.tsx`
  - `QuizPreviewHeader.tsx`
  - `QuizIntroduction.tsx`
  - `SampleParticipantForm.tsx`
  - `QuestionPreview.tsx`
  - `AnswerInterfaces/` - 問題タイプ別の回答インターフェース
  - `NavigationControls.tsx`
  - `ResultsPreview.tsx`
  - `PreviewControlPanel.tsx`
  - `FeedbackNotes.tsx`

- **状態管理**

  - `usePreviewStore.ts` - Zustandストア
    - プレビューモード設定
    - デバイス表示設定
    - 模擬回答データ
    - テスト設定
    - フィードバックメモ
    - 現在の問題インデックス

- **プレビューモード**

  ```typescript
  interface PreviewSettings {
    deviceType: 'desktop' | 'tablet' | 'mobile';
    testDesign: boolean;
    testScoring: boolean;
    testTimeLimit: boolean;
    showExplanations: boolean;
    simulateWrongAnswers: boolean;
  }
  ```

- **模擬データ生成**

  - ランダム回答生成機能
  - 正解/不正解パターン生成
  - 時間経過シミュレーション

- **デバイスシミュレーション**

  - デスクトップ（標準表示）
  - タブレット（768px幅）
  - モバイル（375px幅）
  - 各デバイスでの実際のレンダリング

- **フィードバック保存**

  - プレビュー中に発見した問題点のメモ機能
  - 問題別フィードバックタグ付け

- **API連携**

  - クイズデータ取得: `/api/quizzes/:id/preview`
  - プレビューフィードバック保存: `/api/quizzes/:id/preview-feedback`
  - 模擬採点データ保存: `/api/quizzes/:id/mock-grading`

- **レスポンシブ設計**
  - 実際の公開ページと同じレスポンシブ動作
  - デバイスシミュレーションによる様々な画面サイズでのテスト

## Next.js移行考慮事項

- `app/quizzes/[id]/preview/page.tsx` として実装
- 認証チェックはNext.jsミドルウェアで実装
- デバイスシミュレーションはクライアントコンポーネントで実装
- プレビューデータ取得はServer Componentで実装
- フィードバック保存はServer Actionとして実装

## 特記事項

- プレビューページは管理者専用で、実際のクイズ受験データは記録されない
- 問題・回答オプションはリアルタイムに編集内容が反映される
- デザインカスタマイズ（サブドメイン表示、ロゴ、カラー）を確認可能
- 自由記述問題の模擬採点プロセスを体験できる
- すべての対応デバイスでの表示を確認できる
