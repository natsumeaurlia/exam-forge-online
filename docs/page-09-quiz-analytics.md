# 9. クイズ結果分析ページ

## 概要
クイズの回答データに基づく詳細な分析と可視化を提供するページ。基本的な統計から詳細な問題別分析、時系列分析まで、幅広い分析機能を提供する。

## ページ構成
1. **ページヘッダー**
   - 「分析: [クイズタイトル]」
   - 期間フィルター（全期間、直近30日、直近7日、カスタム）
   - レポートエクスポートボタン（CSV/Excel/PDF）（プロプラン）
   - 「クイズ詳細に戻る」リンク

2. **概要ダッシュボード**
   - 主要指標カード
     - 総回答数
     - 平均スコア
     - 合格率
     - 平均回答時間（プロプラン）
   - トレンドグラフ
     - 時系列での回答数/スコア推移
     - ハイライト付き傾向線

3. **回答者分布**
   - スコア分布ヒストグラム
   - 合格/不合格比率円グラフ
   - ユーザー層分析（プロプラン）
     - デバイスタイプ
     - 地域
     - 回答時間帯

4. **問題別分析**
   - 各問題のパフォーマンス一覧表
     - 問題番号
     - 問題タイプ
     - 正答率
     - 平均回答時間
     - 困難度指標
   - 問題比較チャート
   - 問題詳細ドリルダウン機能

5. **詳細分析**（プロプラン）
   - ヒートマップ
     - 問題×回答パターン
     - 時間帯×正答率
   - 相関分析
     - 問題間の相関
     - 回答時間とスコアの相関
   - パスウェイ分析（条件分岐のあるクイズ）
     - フローチャート表示
     - 経路ごとの成績比較

6. **個別回答者分析**
   - 回答者リスト（検索・フィルター付き）
   - 個別回答詳細表示
   - 回答者比較機能
   - エクスポート機能

7. **レポート生成**（プロプラン）
   - テンプレート選択
   - カスタマイズオプション
   - 自動メール送信設定

## 技術仕様
- **コンポーネント構成**
  - `AnalyticsHeader.tsx`
  - `KeyMetricsCards.tsx`
  - `TrendChart.tsx`
  - `ScoreDistribution.tsx`
  - `QuestionPerformanceTable.tsx`
  - `QuestionComparisonChart.tsx`
  - `HeatmapAnalysis.tsx`
  - `RespondentsList.tsx`
  - `DetailedResponseView.tsx`
  - `ReportGenerator.tsx`

- **状態管理**
  - `useAnalyticsStore.ts` - Zustandストア
    - 選択された期間
    - フィルター条件
    - 選択された問題/回答者
    - 表示オプション
  - TanStack Query
    - 統計データ取得
    - 問題別データ取得
    - 回答者データ取得

- **データ可視化**
  - Recharts、Chart.jsまたはD3.jsを使用
  - 適応型チャート（データ量に応じて表示方法を最適化）
  - ズーム・パン・ドリルダウン機能

- **データ処理**
  - クライアント側での集計・統計計算
  - サーバー側での複雑な分析処理
  - キャッシュ戦略（大量データの効率的な処理）

- **エクスポート機能**
  - CSV/Excel生成（クライアント側）
  - PDF生成（サーバー側）
  - カスタムレポートテンプレート

- **レスポンシブ設計**
  - モバイル: シンプル化されたチャート、スタック表示
  - タブレット: 主要チャートのみ表示、タブによる切り替え
  - デスクトップ: 複数チャート同時表示、詳細分析表示

## Next.js移行考慮事項
- 分析データの取得はServer Componentsで実装
- データ可視化はクライアントコンポーネントとして実装
- フィルタリングやドリルダウンロジックはServer Actionsで実装
- エクスポート機能はAPI Routesとして実装
- 大量データ処理は専用のユーティリティ関数として分離