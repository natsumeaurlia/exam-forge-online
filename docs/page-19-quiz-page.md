# 19. クイズページ（公開ページ）

## 概要

作成したクイズが公開され、受験者がアクセスするページ。カスタムサブドメインを使用して公開され、メインアプリケーションとは別のレイアウトで表示される。共有URLを知っている人、またはパスワードを持っている人が受験できる。

## ページ構成

1. **ヘッダー**

   - クイズタイトル
   - 組織ロゴ（設定されている場合）
   - テーマカラー（カスタマイズされている場合）

2. **導入セクション**

   - クイズの説明文
   - 合格点の表示（設定されている場合）
   - 時間制限の表示（設定されている場合）
   - 問題数と総配点
   - 「開始」ボタン

3. **パスワード保護（該当する場合）**

   - パスワード入力フィールド
   - エラーメッセージ表示
   - 「送信」ボタン

4. **受験者情報フォーム**

   - 名前/メールアドレス入力フィールド（匿名受験の場合）
   - その他必須フィールド（設定に応じて）
   - プライバシーポリシー同意チェックボックス
   - 「開始」ボタン

5. **クイズ本体**

   - 問題カウンター（例：Question 3 of 10）
   - 進捗バー
   - 残り時間表示（時間制限がある場合）
   - 問題文表示
   - メディア表示（画像/音声/動画）（設定されている場合）
   - 回答インターフェース（問題タイプに応じた表示）
   - ナビゲーションボタン（前へ/次へ）
   - 「ヒントを表示」ボタン（設定されている場合）

6. **回答インターフェース（問題タイプ別）**

   - マルバツ問題: 「はい/いいえ」または「○/×」ボタン
   - 指定択一問題: ラジオボタンのリスト
   - 複数選択問題: チェックボックスのリスト
   - 自由記述問題: テキストエリア
   - 高度な問題タイプ（プロプラン）:
     - 並べ替え問題: ドラッグ&ドロップインターフェース
     - 穴埋め問題: インラインテキスト入力
     - 図形指示問題: クリッカブルイメージ

7. **問題ナビゲーションパネル**

   - 問題番号一覧
   - 回答済み/未回答/フラグ付き表示
   - 問題間ジャンプ機能

8. **提出確認モーダル**

   - 未回答問題の警告
   - 最終確認メッセージ
   - 「提出」と「戻る」ボタン

9. **フッター**
   - 著作権表示
   - プラットフォームへの帰属表示（フリープラン）
   - ブランド非表示オプション（プロプラン）

## 技術仕様

- **コンポーネント構成**

  - `QuizHeader.tsx`
  - `QuizIntroduction.tsx`
  - `PasswordProtection.tsx`
  - `ParticipantForm.tsx`
  - `QuizProgress.tsx`
  - `QuestionDisplay.tsx`
  - `AnswerInterfaces/`
    - `TrueFalseInput.tsx`
    - `MultipleChoiceInput.tsx`
    - `CheckboxInput.tsx`
    - `TextInput.tsx`
    - `AdvancedInputs/`
  - `NavigationPanel.tsx`
  - `SubmitConfirmation.tsx`
  - `QuizFooter.tsx`

- **状態管理**

  - `useQuizTakingStore.ts` - Zustandストア
    - 認証状態（パスワードチェック）
    - 受験者情報
    - 現在の問題インデックス
    - 回答データ
    - 残り時間
    - フラグ付き問題
    - 回答進捗状態

- **テーマ設定**

  - カスタムサブドメイン表示
  - 組織のカラースキーム適用
  - ロゴ表示
  - フォント設定

- **データ保存**

  - 回答のローカルストレージ自動保存
  - サーバーへの進捗定期送信（回線切断対策）

- **API連携**

  - クイズデータ取得: `/api/public/quizzes/:subdomain`
  - パスワード検証: `/api/public/quizzes/:subdomain/verify`
  - 回答保存: `/api/public/quizzes/:subdomain/save`
  - 回答提出: `/api/public/quizzes/:subdomain/submit`

- **セキュリティ機能**

  - CSRF対策
  - レート制限
  - 不正アクセス検知

- **レスポンシブ設計**
  - モバイル: 単一カラム表示、タッチフレンドリーインターフェース
  - タブレット: 最適化された問題表示、サイドパネルは折りたたみ可能
  - デスクトップ: フル機能表示、サイドナビゲーションパネル常時表示

## Next.js移行考慮事項

- `app/quiz/[subdomain]/page.tsx` として実装
- ISRまたはSSGでクイズデータを事前レンダリング
- 認証チェックはクライアントコンポーネントで実装
- 回答提出はServer Actionとして実装
- メディア最適化はNext.js Imageコンポーネントで実装
