# 12. クイズ受験ページ

## 概要

受験者がクイズに回答するためのページ。様々な問題タイプの表示、回答の記録、進捗管理、制限時間管理などの機能を提供する。

## ページ構成

1. **ヘッダーバー**

   - クイズタイトル
   - 受験者情報（ログインしている場合）
   - 残り時間表示（時間制限がある場合）
   - 進捗インジケーター

2. **導入セクション**

   - クイズの説明
   - 受験者情報入力（匿名受験の場合）
     - 名前/メールアドレス
     - その他必須フィールド
   - 開始ボタン

3. **問題表示エリア**

   - 問題テキスト
   - メディア表示（画像/音声/動画）（プロプラン）
     - 複数メディアの表示対応
     - 画像：インライン表示、拡大表示対応
     - 動画：再生コントロール付きプレーヤー
     - レスポンシブ対応のメディア表示
     - MinIO CDNからの高速配信
   - 問題タイプに応じた回答インターフェース
     - マルバツ問題: ラジオボタン
     - 指定択一問題: ラジオボタン
     - 複数選択問題: チェックボックス
     - 自由記述問題: テキストエリア
     - 高度な問題タイプ（プロプラン）
       - 並べ替え問題: ドラッグ&ドロップ
       - 穴埋め問題: インラインテキスト入力
       - 図形指示問題: クリッカブルエリア
   - ヒントボタン（オプション）

4. **ナビゲーションコントロール**

   - 前の問題/次の問題ボタン
   - 問題番号ナビゲーション（ジャンプ可能）
   - 「フラグを立てる」機能（後で見直すためのマーク）
   - 回答状況インジケーター（回答済み/未回答/フラグ付き）

5. **サイドパネル**（デスクトップ表示）

   - 全問題のナビゲーション一覧
   - 回答状況の視覚的表示
   - 残り時間（大きく表示）
   - 「すべて提出」ボタン

6. **提出確認モーダル**

   - 未回答問題の警告
   - 最終確認メッセージ
   - 「提出」と「戻る」ボタン

7. **カンニング防止機能**（プロプラン）
   - 全画面モード強制
   - 画面離脱検知
   - コピー&ペースト制限
   - 複数タブ/ウィンドウ検知

## 技術仕様

- **コンポーネント構成**

  - `QuizHeader.tsx`
  - `IntroductionSection.tsx`
  - `QuestionDisplay.tsx`
  - `AnswerInterface/` - 問題タイプ別の回答インターフェース
    - `TrueFalseAnswer.tsx`
    - `MultipleChoiceAnswer.tsx`
    - `CheckboxAnswer.tsx`
    - `TextAnswer.tsx`
    - `AdvancedAnswers/` - プロプラン問題タイプ
  - `NavigationControls.tsx`
  - `QuestionNavPanel.tsx`
  - `SubmitConfirmModal.tsx`
  - `ProctoringSecurity.tsx`

- **状態管理**

  - `useQuizTakingStore.ts` - Zustandストア
    - 現在の問題インデックス
    - 回答データ
    - 残り時間
    - フラグ付き問題
    - 回答状況

  ```typescript
  interface QuizTakingState {
    currentQuestionIndex: number;
    answers: Record<string, any>; // 問題IDをキーとした回答データ
    flaggedQuestions: Set<string>; // フラグ付き問題のIDセット
    remainingTime: number | null; // 秒単位、null は制限なし
    startTime: number; // タイムスタンプ
    submitting: boolean;
    // ... アクション
  }
  ```

- **自動保存機能**

  - ローカルストレージへの一時保存
  - 定期的なAPIへの進捗保存
  - 回線切断時の回復機能

- **時間管理**

  - クイズ全体またはセクション/問題ごとの制限時間
  - サーバー時間との同期
  - 残り時間アラート

- **セキュリティ機能**

  - 回答データの暗号化
  - セッション確認
  - Bot対策

- **アクセシビリティ**

  - キーボードナビゲーション
  - スクリーンリーダー対応
  - ハイコントラストモード

- **API連携**

  - クイズデータ取得: `/api/take/:quizId`
  - 回答保存: `/api/take/:quizId/save`
  - 最終提出: `/api/take/:quizId/submit`

- **レスポンシブ設計**
  - モバイル: 問題のみ表示、底部ナビゲーション
  - タブレット: 問題 + 簡易ナビゲーション
  - デスクトップ: 問題 + サイドパネルナビゲーション

## Next.js移行考慮事項

- クイズデータの初期読み込みはServer Componentで実装
- 回答インターフェースはクライアントコンポーネント化
- 回答保存はServer Actionとして実装
- セキュリティ機能はクライアントコンポーネントとして実装
- ローカルストレージ機能はクライアントコンポーネント内で実装
