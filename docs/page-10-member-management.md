# 10. メンバー管理ページ

## 概要

テナント内のメンバー（ユーザー）を管理するページ。メンバーの招待、役割の設定、権限の管理、削除などの機能を提供する。テナントオーナーとテナント管理者のみがアクセス可能。

## ページ構成

1. **ページヘッダー**

   - 「メンバー管理」タイトル
   - 「メンバーを招待」主要CTAボタン
   - プラン使用状況表示（例：15/20メンバー使用中）

2. **メンバーリスト**

   - テーブル表示
     - ユーザー名/メールアドレス
     - 役割（オーナー/管理者/メンバー）
     - ステータス（アクティブ/招待中/停止中）
     - 最終ログイン日時
     - アクション（役割変更、削除など）
   - ソート機能
   - フィルター機能（役割、ステータス）
   - 検索機能

3. **メンバー招待モーダル**

   - 個別招待フォーム
     - メールアドレス入力
     - 役割選択
     - パーソナルメッセージ（オプション）
   - 一括招待フォーム（プロプラン）
     - CSVアップロード
     - メールアドレスリスト貼り付け

4. **役割/権限設定**

   - 役割の説明
   - 各役割の権限一覧
   - カスタム役割作成（エンタープライズプラン）

5. **チーム管理**（プロプラン）

   - チーム一覧
   - チーム作成/編集
   - メンバーのチーム割り当て
   - チームごとの権限設定

6. **招待履歴**

   - 送信済み招待の一覧
   - 招待ステータス（保留中/承諾済み/期限切れ）
   - 招待の再送/キャンセル

7. **監査ログ**（エンタープライズプラン）
   - メンバー関連のアクションログ
   - フィルターと検索機能

## 技術仕様

- **コンポーネント構成**

  - `MembersHeader.tsx`
  - `MembersTable.tsx`
  - `InviteMemberModal.tsx`
  - `BulkInviteForm.tsx`
  - `RolePermissionsCard.tsx`
  - `TeamManagement.tsx`
  - `InvitationHistory.tsx`
  - `AuditLog.tsx`

- **状態管理**

  - `useMembersStore.ts` - Zustandストア
    - 表示フィルター
    - ソート条件
    - 選択されたメンバー
    - モーダル表示状態
  - TanStack Query
    - メンバーリスト取得
    - 招待履歴取得
    - チーム情報取得

- **API連携**

  - メンバー一覧取得: `/api/members`
  - メンバー招待: `/api/invitations`
  - 役割更新: `/api/members/:id/role`
  - メンバー削除: `/api/members/:id`
  - チーム管理: `/api/teams`
  - 監査ログ取得: `/api/audit-logs/members`

- **メール通知**

  - 招待メール送信
  - 役割変更通知
  - アクセス削除通知

- **CSVインポート/エクスポート**

  - 一括招待テンプレートダウンロード
  - CSVパース処理
  - メンバーリストエクスポート

- **権限チェック**

  - ページアクセス制限（オーナー/管理者のみ）
  - UI上での権限に基づく機能制限

- **レスポンシブ設計**
  - モバイル: カード表示、制限されたアクション
  - タブレット: 簡略化テーブル
  - デスクトップ: フル機能テーブル表示

## Next.js移行考慮事項

- メンバーリスト取得はServer Componentで実装
- 招待・権限変更などのアクションはServer Actionsで実装
- 権限チェックはNext.jsミドルウェアで実装
- メール送信処理はAPI Routes（またはServer Action）で実装
- テーブルコンポーネントはクライアントコンポーネントとして実装
